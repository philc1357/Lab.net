Heute habe ich das Lab net erneut von 0 aufgebaut zur Wiederholung. Ebenfalls habe ich dadurch das Hardening rückgängig gemacht um weiterhin Angruffe durchzuführen.
Desweiteren habe ich einen Ubunutu Server dem Lab hinzugefügt um Webangriffe zu verstehen.

-----

Neues Lab:

Windows Server Evaluation 22 als DC
- 10.0.0.20/24 als IP
- 10.0.0.20 als DNS

KALI Linux als Angreifer
- 10.0.0.30/24 als IP
- 10.0.0.20 als DNS

Windows 10 Client
- 10.0.0.10/24 als IP
- 10.0.0.20 als DNS

Ubuntu Server als Webserver
- 10.0.0.40 als IP
- apache2 mariadb-server php php-mysql vsftpd ufw
- Ports 21 80 3306 offen
- MySQL-Datenbank firma mit Tabelle contact_form erstellt.
- index.php in /var/www/html erstellt die ein kleines Kontaktformular enthält, welches in die Datanbank eingefügt wird.

-----

Danach habe ich von allen Geräten eine Ping Abfrage zu allen Geräten gemacht.
Ergebnis:
Ubuntu und Kali finden keinen Win Client.

Lösung:
ICMPv4 Regel erlauben in der Firewall.

Ergebnis:
Ubuntu und Kali finden den Win Client

-----

Als nächstes Habe ich den Windows Server PC umbenannt in DC01 um ihn als Domain Controller zu identifizieren. -> Neustart.


Danach habe ich im Server Manager die Active Directory Features hinzugefügt.


Server zum DC hochgestuft:
- Neue Gesamtstruktur hinzufügen
- Stammdomäne: lab.local
- Kennwort zur Wiederherstellung
- Installieren
- Reboot

Test: 
Nach reboot Server-Manager geöffnet
->Tools ->AD Domänen und Vertrauensstellen
la.local wird angezeigt.
Alles funktioniert.

-----

AD Struktur anlegen
Als erstes erstellen wir eine grobe Struktur
-ServerManager -> Tools -> AD Benutzer und Computer
rechtsklick auf lab.local -> neu -> Organisationseinheit:
LAB-USERS
 - LAB-Admins
 - LAB-Employees
 - LAB-Praktika
LAB-Groups
(alles Organisationseinheiten)


in LAB-Groups wwerden neue Gruppen angelegt:
GRP_Admin
GRP_Employees
GRP_Praktika


-----

in Jeder Gruppe wird jeweils 1 Benutzer erstellt:
LAB-Admins: Aaron-> Mitglied von Domänen-Admins und GRP_Admin

LAB-Employees: Levin-> Mitglied von GRP_Employees

LAB-Praktika: Xenia-> Mitglied von GRP_Praktika - unsicheres Passwort.


-----
Im DC einen Ordner erstellt:
C:/share/Data

Eigenschaften-Freigabe-erweiterte Freigabe-Berechtigungen:
GRP_Employees - Ändern, Lesen
GRP_Praktika - Lesen

Eigenschaften-Sicherheit:
GRP_Employees, GRP_Praktika hinzugefügt und die gleichen Rechte verteilt.


-----
Nun wollte ich mich auf dem Win Client Als ein Domänenbenutzer einloggen, sah aber dass ich mich mit keinem Nutzer anmelden konnte.

Fehler: sysdm.cpl geöffnet und da konnte ich sehen dass der Client nur Mitglied der Arbeitsgruppe ist, nicht aber der Domäne.
also habe ich ihn manuell der Domäne lab.local hinzugefügt und konnte mich anschließend mit Domänenbenutzer anmelden.

Da Levin in der Gruppe GRP_Employees ist wechselte ich mit "Windows+R" zu "\\10.0.0.20\Data". Hier erstelle ich einen Ordner "Test/Employee". 
Erfebnis: Erfolgreich, wie erwartet

Das gleiche teste ich nun mit dem Benutzer Xenia.
Problem: Beim Einloggen soll Xenia ein neues Passwort bekommen welches zu Testzwecken sehr schwach sein soll. Die Domänenrichtlinien verhindern ein unsicheres Passwort:

Also müssen wir die Passwortrichtlinien anpassen.

Auf DC:
Server-Manager->Tools->AD-Verwaltingscenter

Links auf lab.local Pfeil dann:
System->Password Settings Container->Neu
Die Einstellungen sind zu finden auf dem Bild "pwd_GRP_Praktika.png"

Die Einstellungen wurden nur auf die Gruppe GRP_Praktika angewandt.
