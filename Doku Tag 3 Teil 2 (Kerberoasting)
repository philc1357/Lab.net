1. Zielsetzung

Ich wollte in meinem isolierten Cyber-Lab nachvollziehen, wie Kerberoasting funktioniert, wie Angreifer Kerberos-Tickets manipulieren und wie man aus einem Service-Account Hashes extrahiert, um später auf Systeme zuzugreifen.

Dabei ging es rein um Lerneffekt – alles legal in meiner eigenen Testumgebung.


---

2. Voraussetzungen im Lab

Meine Active-Directory-Umgebung bestand aus:

Domain Controller (Windows Server) – 10.0.0.20

Windows Client – 10.0.0.10

Kali Linux (Angreifer) – 10.0.0.30

Domäne: lab.local

Benutzer: Aaron, Xenia, Kevin, svc-sql

svc-sql ist ein Service-Account mit SPN → wichtig für Kerberoasting



---

3. Benutzer- und SPN-Enumeration

Ich habe zuerst über Kali die benötigten Benutzerinformationen aus dem AD abgefragt:

GetUserSPNs.py lab.local/Aaron:<Passwort> -dc-ip 10.0.0.20 -request

Ergebnis:
Der Service-Account svc-sql besitzt ein SPN (Service Principal Name) und ist daher ein perfektes Ziel für Kerberoasting.


---

4. Anfordern des Kerberos-Service-Tickets (TGS)

Als nächstes habe ich über das Tool GetUserSPNs.py das Ticket (TGS) für den SPN angefordert:

GetUserSPNs.py lab.local/Aaron:<Passwort> -dc-ip 10.0.0.20 -request

Dieses Kommando liefert am Ende eine Zeile, die mit
$krb5tgs$23$...
beginnt – das ist der Kerberos-Hash, den ich später offline cracken kann.


---

5. Offline-Cracking des TGS-Hashes

Da Kerberos-Hashes offline geknackt werden können (ohne weitere Interaktion mit dem Domain Controller), habe ich den Hash in eine Datei geschrieben und mit Hashcat bearbeitet:

hashcat -m 13100 hash.txt wordlist.txt

Ergebnis:
Das Passwort des Service-Accounts wurde erfolgreich offline ermittelt.


---

6. Verwendung des Service-Account-Passworts

Mit dem gewonnenen Passwort konnte ich anschließend:

mich gegenüber dem Domain Controller authentifizieren

psexec/wmiexec testen

Remote-Auskünfte einholen

mich auf dem Windows-Client bewegen


Beispiel:

impacket-psexec lab.local/svc-sql:<Passwort>@10.0.0.10

Dadurch erhielt ich eine Remote-Shell auf dem Windows-Client, bei der ich direkt im C:-Verzeichnis Befehle ausführen konnte.


---

7. Erkenntnisse

Durch Kerberoasting habe ich gelernt:

Kerberos nutzt schwache Verschlüsselung für Service-Tickets

Jeder Domain-User darf TGS-Tickets anfordern

Offline-Cracking ist sehr effektiv

Service-Accounts sind oft schlecht gesichert

Ein kompromittierter Service-Account ermöglicht Lateral Movement


Kerberoasting ist damit ein realer und häufig unterschätzter Angriffsvektor in Active-Directory-Umgebungen.


---

8. Fazit

Ich konnte erfolgreich:

SPNs identifizieren

TGS-Tickets anfordern

Kerberos-Hashes extrahieren

Passwort cracken

Remote-Zugriff auf ein System erlangen


Damit verstehe ich den gesamten Ablauf eines Kerberoasting-Angriffs – von der Enumeration bis zur tatsächlichen Systemübernahme.